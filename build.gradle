import org.jetbrains.kotlin.gradle.tasks.KotlinCompile

buildscript {
    dependencies {
        classpath "io.github.febb:BuildMetaUtils:1.0-SNAPSHOT"
    }
}
plugins {
    id("org.jetbrains.kotlin.jvm") version "1.3.72"
}

apply plugin: MetaUtils

metaUtils {
    def mcJar = createJarTest("testOriginalJar")
    def interfaceStubs = createJarTest("interfaceStubs")
    mcJar.compileClasspath += interfaceStubs.output
    sourceSets.test.runtimeClasspath += mcJar.output
}
tasks.compileTestOriginalJarJava.options.compilerArgs += "-parameters"

configurations {
    resultTestCompile.extendsFrom testCompile
    resultTestRuntime.extendsFrom testRuntime
}

sourceSets {
    resultTest {
        compileClasspath += sourceSets.testOriginalJar.output
        runtimeClasspath += sourceSets.testOriginalJar.output
    }
}


task resultTest(type: Test) {
    group 'Verification'
    description 'Runs the resultTest tests.'
    testClassesDirs = sourceSets.resultTest.output.classesDirs
//    testClassesDirs =
    classpath = sourceSets.resultTest.runtimeClasspath

    useJUnitPlatform()

    maxHeapSize = '1G'

}

//tasks.each {println it}
//tasks.compileResultTestKotlin.dependsOn(tasks.test)


group("io.github.febb")
version("1.0-SNAPSHOT")

repositories {
    mavenCentral()
}

dependencies {
    implementation("org.ow2.asm:asm:8.0.1")
    implementation("org.jetbrains.kotlin:kotlin-stdlib-jdk8")
    implementation 'org.ow2.asm:asm-tree:8.0.1'
    implementation("io.github.febb:MetaUtils:1.0-SNAPSHOT")

    testImplementation 'org.jetbrains.kotlin:kotlin-test-junit5:1.3.72'
    testRuntime('org.junit.jupiter:junit-jupiter-engine:5.4.2')
    resultTestImplementation 'org.jetbrains.kotlin:kotlin-test-junit5:1.3.72'
    resultTestRuntime('org.junit.jupiter:junit-jupiter-engine:5.4.2')

//    def testResultJar = files("")
    resultTestImplementation(files("build/resources/test/abstractedSrcCompiled.jar"))
}

tasks.withType(KotlinCompile) {
    kotlinOptions.jvmTarget = "1.8"

}


test {
    useJUnitPlatform()

    maxHeapSize = '1G'
}

//
//test {
//    useJUnitPlatform()
//
//    maxHeapSize = '1G'
//}